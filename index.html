<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Rotation Matching Challenge</title>
    <!-- MathJax for mathematical notation -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>Rotation Matching Challenge</h1>
        <p class="subtitle" id="subtitle">Unite the Turkeys in Love ‚Ä¢ Master SO(n) ‚Ä¢ Find the Hidden Rotation</p>
      </header>
      <div class="game-container">
        <div class="about">
          <p>
            <strong>The Story:</strong> Two turkeys have fallen deeply in love and want to travel together through space, but they're on different paths! 
            The orange turkey follows the original path, while the cyan turkey's path has been mysteriously rotated. 
            Your mission is to rotate the cyan turkey's path until it perfectly aligns with the orange turkey's path, so these two can finally journey together. ‚ù§Ô∏èü¶É
          </p>
          <p>
            <strong>The Challenge:</strong> Two smooth curves are displayed in $\mathbb{R}^n$ (on the sphere $S^{n-1}$ for $n \geq 3$, inside the ball for $n=2$).
            The orange curve (fixed) is the original path. The cyan curve (rotating) is the same path rotated by a secret matrix $R \in \text{SO}(n)$
            (a uniformly random rotation sampled from the Haar measure). Your goal is to rotate the cyan curve until it aligns perfectly with the orange curve.
          </p>
          <p>
            <strong>Mathematical Structure:</strong> This demonstrates what John W. Tukey called a "draughtsman's display": a matrix of pairwise scatterplots showing all ${n \choose 2}$ orthogonal projections simultaneously in an $n \times n$ matrix.
            The original path $\gamma: [0,1] \to \mathbb{R}^n$ is a smooth curve. The target curve is $R\gamma(t)$ for some unknown $R \in \text{SO}(n)$. You control an orientation matrix $Q \in \text{SO}(n)$
            by applying incremental rotations. The orange curve stays fixed while the cyan curve transforms as $Q^T R\gamma(t)$.
            When $Q = R$, we have $Q^T R = I$, so the cyan curve matches the orange, and you win!
          </p>
          <p>
            Cell $(i,j)$ displays the 2D projection $\pi_{ij}: \mathbb{R}^n \to \mathbb{R}^2$ defined by $\pi_{ij}(\mathbf{x}) = (x_j, x_i)$ where $\mathbf{x} = Q^T(\mathbf{p}_{\text{world}} - \mathbf{p})$ transforms world coordinates into your oriented local frame.
            Rotating your basis $Q$ reveals how the $n$-dimensional structure projects into each 2D plane.
          </p>
          <p>
            The matrix‚Äëof‚Äëscatterplots idea was originated by J. A. Hartigan in
            <a href="https://scholar.google.com/scholar?q=Hartigan+Printer+Graphics+for+Clustering+1975" target="_blank" rel="noopener noreferrer">Printer Graphics for Clustering (1975)</a>,
            where he arranged pairwise dot plots to reveal structure for cluster analysis. Tukey popularized the display and the name "draughtsman's display"; it later became widely known as the scatterplot matrix (SPLOM).
          </p>
        </div>
        <div class="controls-section">
          <div class="section-title">Challenge Controls</div>
          <div class="divider"></div>
          <div class="goal-callout"><strong>Goal:</strong> Help the turkeys unite by rotating the cyan path to align with the orange path</div>
          <div class="instructions instructions-top">
            <p><strong>Rotate:</strong> Hold on any off-diagonal cell (i, j) to rotate in that plane</p>
            <p><strong>Auto-Rotate:</strong> Automatically rotate partway toward the solution</p>
            <p><strong>New Puzzle:</strong> Click "New Challenge" for a fresh rotation</p>
          </div>
          <div class="dimension-selector">
            <label for="dimension-select">Dimensions:</label>
            <select id="dimension-select">
              <option value="2">2D</option>
              <option value="3">3D</option>
              <option value="4" selected>4D</option>
              <option value="5">5D</option>
            </select>
          </div>
          <div class="display-mode-selector">
            <label for="display-mode-select">Display Mode:</label>
            <select id="display-mode-select">
              <option value="turkey" selected>Turkey</option>
              <option value="vanilla">Vanilla</option>
              <option value="rainbow">Rainbow</option>
              <option value="numbered">Numbered</option>
            </select>
          </div>
          <div class="grid-toggle">
            <label>
              <input type="checkbox" id="grid-toggle">
              Show grid
            </label>
          </div>
          <div class="mobile-view-toggle">
            <label>
              <input type="checkbox" id="mobile-view-toggle">
              Mobile view
            </label>
          </div>
          <div class="mobile-overlay-toggle">
            <label>
              <input type="checkbox" id="mobile-overlay-toggle">
              Show overlay
            </label>
          </div>
          <div class="gradient-widget-toggle">
            <label>
              <input type="checkbox" id="gradient-widget-toggle">
              Show gradient hints
            </label>
          </div>
          <div class="distance-info-toggle">
            <label>
              <input type="checkbox" id="distance-info-toggle">
              Show distance
            </label>
          </div>
          <div class="auto-lock-toggle">
            <label>
              <input type="checkbox" id="auto-lock-toggle">
              Auto-lock near solution
            </label>
          </div>
          <div class="auto-lock-threshold" style="display: none; margin-left: 1.5rem; margin-top: 0.25rem;">
            <label for="auto-lock-threshold-input" style="font-size: 0.85em; color: #b8c5d6;">
              Threshold:
              <input type="number" id="auto-lock-threshold-input" min="0.1" max="2.0" step="0.1" value="0.5" style="width: 60px; margin-left: 0.5rem;">
            </label>
          </div>
          <div class="turkey-trail-toggle">
            <label>
              <input type="checkbox" id="turkey-trail-toggle">
              Show turkey trail
            </label>
          </div>
        </div>

        <div class="controls">
          <button id="new-challenge-button">New Challenge</button>
          <button id="half-distance-button">Auto-Rotate</button>
        </div>

        <div class="play-area">
          <canvas id="game-canvas"></canvas>
          <div id="mobile-grid-container" class="mobile-grid-container" style="display: none;"></div>

          <div class="info-panel">
            <div class="stat">
              <span class="label">Distance:</span>
              <span id="alignment-score">‚Äî</span>
            </div>
            <div class="stat">
              <span class="label">Best Distance:</span>
              <span id="best-score">‚Äî</span>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="version-info">
          Build: <span id="git-hash">loading...</span>
        </div>
      </footer>
    </div>
    <div id="scroll-hint" class="scroll-hint">
      <div class="hint-text">Scroll to Play</div>
      <div class="chevrons" aria-hidden="true">
        <svg width="20" height="20" viewBox="0 0 24 24">
          <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg width="20" height="20" viewBox="0 0 24 24">
          <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>
    <script type="module" src="/src/rotation-challenge-main.js"></script>
  </body>
</html>
